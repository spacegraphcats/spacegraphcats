
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://spacegraphcats.github.io/spacegraphcats/04-spacegraphcats-parameters/">
      
      
        <link rel="prev" href="../03-visualizing-spacegraphcats/">
      
      
        <link rel="next" href="../05-alpha-spacegraphcats/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.7">
    
    
      
        <title>Tuning parameters in spacegraphcats - spacegraphcats documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue_grey" data-md-color-accent="black">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spacegraphcats-parameters" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="spacegraphcats documentation" class="md-header__button md-logo" aria-label="spacegraphcats documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21 12-7-7v4C7 10 4 15 3 20c2.5-3.5 6-5.1 11-5.1V19l7-7Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            spacegraphcats documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tuning parameters in spacegraphcats
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/spacegraphcats/spacegraphcats" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spacegraphcats
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="spacegraphcats documentation" class="md-nav__button md-logo" aria-label="spacegraphcats documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21 12-7-7v4C7 10 4 15 3 20c2.5-3.5 6-5.1 11-5.1V19l7-7Z"/></svg>

    </a>
    spacegraphcats documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spacegraphcats/spacegraphcats" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spacegraphcats
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../0a-primer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Primer on metagenomics and assembly graphs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Using spacegraphcats
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Using spacegraphcats
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../00-installing-spacegraphcats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing spacegraphcats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../01-running-spacegraphcats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running spacegraphcats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../02-spacegraphcats-use-cases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spacegraphcats use cases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../03-visualizing-spacegraphcats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualizing spacegraphcats outputs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Tuning parameters in spacegraphcats
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Tuning parameters in spacegraphcats
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#k-mer-size" class="md-nav__link">
    K-mer size
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#radius-size" class="md-nav__link">
    Radius size
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-defaults-k-31-r-1" class="md-nav__link">
    The defaults: k = 31, r = 1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#do-unwanted-sequences-sneak-in-especially-at-larger-radius-sizes" class="md-nav__link">
    Do unwanted sequences sneak in, especially at larger radius sizes?
  </a>
  
    <nav class="md-nav" aria-label="Do unwanted sequences sneak in, especially at larger radius sizes?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#querying-a-metagenome-with-a-complete-metagenome-assembled-genome" class="md-nav__link">
    Querying a metagenome with a "complete" metagenome assembled genome
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring-taxonomy-of-cdbg-nodes-within-dominators-using-a-simple-metagenome" class="md-nav__link">
    Exploring taxonomy of cDBG nodes within dominators using a simple metagenome
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../05-alpha-spacegraphcats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Alpha functionality in spacegraphcats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../06-snakemake-spacegraphcats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrating spacegraphcats into a snakemake workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../calculating-taxonomic-purity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Calculating taxonomic purity of spacegraphcats outputs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../developing-spacegraphcats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer's guide
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#k-mer-size" class="md-nav__link">
    K-mer size
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#radius-size" class="md-nav__link">
    Radius size
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-defaults-k-31-r-1" class="md-nav__link">
    The defaults: k = 31, r = 1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#do-unwanted-sequences-sneak-in-especially-at-larger-radius-sizes" class="md-nav__link">
    Do unwanted sequences sneak in, especially at larger radius sizes?
  </a>
  
    <nav class="md-nav" aria-label="Do unwanted sequences sneak in, especially at larger radius sizes?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#querying-a-metagenome-with-a-complete-metagenome-assembled-genome" class="md-nav__link">
    Querying a metagenome with a "complete" metagenome assembled genome
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring-taxonomy-of-cdbg-nodes-within-dominators-using-a-simple-metagenome" class="md-nav__link">
    Exploring taxonomy of cDBG nodes within dominators using a simple metagenome
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="spacegraphcats-parameters">Spacegraphcats parameters</h1>
<p>There are two parameters that control the behavior of spacegraphcats: k-mer size (<em>k</em>) and radius size (<em>r</em>).
Both of these parameters are specified in the config file.
We have tested spacegraphcats behavior most extensively with a k-size = 31 and radius = 1, but below we explore how these parameters behave with different values in real metagenomes. 
As we have not exhaustively tested different parameters, below we discuss the role of these parameters in changing spacegraphcats outputs in the context of a variety of sequencing data. 
Our goal is to help the user build an intuition for the behavior of these parameters and how they may impact spacegraphcats output in the context of different sequencing data. </p>
<h2 id="k-mer-size">K-mer size</h2>
<p>The k-mer size is used to build the compact de Bruijn graph (cDBG, e.g. assembly graph).
Smaller k-mer sizes will collapse more sequences together. 
This can be seen in a supplemental graph from the Bandage publication, included below. 
On the far left, the graph is built with a k-mer size of 21 and appears as a denser component than the graph on the far right that is built with a k-merm size of 127.</p>
<p><img alt="" src="https://i.imgur.com/ZcvJzAX.png" /> <em>Source <a href="https://academic.oup.com/bioinformatics/article/31/20/3350/196114">Wick et al. 2015</a></em></p>
<p>Most metagenome assemblers iteratively build assembly graphs with different k-mer sizes, and select the paths in the graphs that generate the longest/least branching paths to generate linear contigs. 
Spacegraphcats uses a single k-mer size to generate its cDBG. 
As is seen in the picture above, this will impact the topology of the cDBG.</p>
<p>We use a <em>k</em> = 31 as the "default" k-mer size in spacegraphcats. 
We selected this size because there is substantial k-mer overlap between genomes from the same species at a k-size of 31 (see the <a href="https://msystems.asm.org/content/1/3/e00020-16">Metapalette paper</a> for a larger discussion of sequence similarity between genomes at different <em>k</em> sizes.)
Because of this overlap, it follows that k-mers from the same species would be graph-adjacent in the cDBG.</p>
<p>Note that there is substantial overlap between genomes of the same genus at a k-size of 21, and substantial overlap between genomes of the same strain at a k-size of 51.</p>
<h2 id="radius-size">Radius size</h2>
<p>The radius size controls the maximum distance a node in the cDBG can be from a dominating node. 
The figure below is reproduced from the spacegraphcats paper. 
"Starting from a collection of genomic sequences (a), we form an assembly graph where nodes represent distinct linear subsequences (b). 
In this assembly graph, known as a compact De Bruijn graph, nodes may represent many k-mers. 
The original genomic sequences correspond to walks in the graph, and shared nodes between the walks represent shared subsequences. 
<strong>c</strong> We then identify a subset of nodes <em>D</em> called a dominating set so that every node in the assembly graph is at distance at most one from some member of <em>D</em> (marked pink). 
We further partition the graph into pieces by assigning every node to exactly one of the closest members of <em>D</em> (beige regions in <strong>c</strong> and <strong>d</strong>). 
For a genomic query <em>Q</em>, the neighborhood of <em>Q</em> in this graph is the union of all pieces which share at least one k-mer with the query. 
The colorful subsets of the pieces in d correspond to the neighborhoods of the queries <em>Q1</em>,<em>Q2</em></p>
<p><img alt="" src="https://media.springernature.com/full/springer-static/image/art%3A10.1186%2Fs13059-020-02066-4/MediaObjects/13059_2020_2066_Fig1_HTML.png?as=webp" /> <em>Source: <a href="https://doi.org/10.1186/s13059-020-02066-4">Brown et al. 2020</a></em>  </p>
<p>In this figure, the dominating set has a <em>radius</em> = 1, where any node is at most distance 1 from a node in the dominating set. 
As the radius expands, the pieces "dominated" by each node in the dominating set will contain more nodes, and therefore more nucleotides.</p>
<h2 id="the-defaults-k-31-r-1">The defaults: <em>k</em> = 31, <em>r</em> = 1</h2>
<p>When using the "default" spacegraphcats parameters, relatively little k-mer sequence overlap is necessary between the query sequence and the query neighborhood to recover substantial portions of closely related genomes.<br />
The figure below is reproduced from the spacegraphcats paper. 
It demonstrates that with a Jaccard similarity between 10<sup>-2</sup> and 10<sup>-3</sup>, 20-40% of a target genome sequence is recovered from a metagenome query. 
This jumps to &gt;80% when Jaccard similarity exceeds 10<sup>-1</sup>. 
Panel B shows that an approximately 1 Mbp overlap between two genomes is sufficient to recover approximately 2.3 Mbp of unknown sequence from the closely related <em>Proteiniclasticum</em> genomes.</p>
<p><img alt="" src="https://media.springernature.com/full/springer-static/image/art%3A10.1186%2Fs13059-020-02066-4/MediaObjects/13059_2020_2066_Fig2_HTML.png?as=webp" /> <em>Source: <a href="https://doi.org/10.1186/s13059-020-02066-4">Brown et al. 2020</a></em></p>
<p>Below, we show an approximate conversion between Jaccard similarity and Average Nucleotide Identity (ANI) at different k-mer sizes using simulated sequences (<a href="https://github.com/bluegenes/2021-simseq-compare/blob/main/notebooks/007.jaccard-to-true-ANI-explore.ipynb">notebook here</a>).
A Jaccard similarity of 0.10 corresponds approximately to 95% ANI at a k-mer size of 31.</p>
<p><img alt="" src="https://i.imgur.com/01TaIw3.png" /> <em>Image courtesy of Tessa Pierce Ward.</em></p>
<h2 id="do-unwanted-sequences-sneak-in-especially-at-larger-radius-sizes">Do unwanted sequences sneak in, especially at larger radius sizes?</h2>
<p>Generally speaking, we have not found that spacegraphcats genome queries on real metagenomes on catlases built with a k-size of 31 and a radius of 1 accidentally scoop in extra k-mers from the wrong taxonomy, but we have not tested this systematically. </p>
<p>Anecdotally:</p>
<ol>
<li>When we queried into ~600 human stool metagenomes using a genome sequence from <em>Rumminococcus gnavus</em> and with parameters <em>k</em> = 31 and <em>r</em> = 1, running strainphlan on the resulting query neighborhoods indicated that only <em>R. gnavus</em> was present.</li>
<li>Using the same query neighborhoods described above, running singleM demonstrated that some query neighborhoods contained reads from marker genes consistent with different taxonomic ranks. 
Singlem searches reads for 14 marker genes, and assigns taxonomy to a sample based on those marker genes. 
Given that there is more likely to be shared k-mers in conserved single copy marker genes, it is possible that spacegraphcats pulls in some reads from these conserved regions.</li>
<li>Using a gene of interest as a query, query neighborhoods often contain variation for that gene, as well sequences for upstream genes that are typcially co-located in a genome (e.g. querying with <em>gyrA</em> leads to the paritial recover of <em>gyrB</em>). </li>
</ol>
<h3 id="querying-a-metagenome-with-a-complete-metagenome-assembled-genome">Querying a metagenome with a "complete" metagenome assembled genome</h3>
<p>Metagenome assembled genomes are composite genomes comprising fragmented genome sequences from closely related genomes in a community.
Generally, these genomes are highly fragmented due to assembly errors that arise from, among other things, strain variation and shallow sequencing coverage.
"Complete" metagenome assembled genomes (CMAGs) are circularized metagenome assembled genomes with no gaps (see <a href="https://genome.cshlp.org/content/30/3/315.full">Chen et al. 2020</a>).
In multi-species communities, there are likely specific ecoevolutionary conditions that lead to sequencing data that allow the potential recovery of a CMAGs.
For this to be possible, a genome likely needs to have very little strain variation, high abundance/coverage, and not be closely related to other genomes in the population.     </p>
<p>Given these conditions, we were curious whether 
1. CMAGs contain additional variation not captured by curation techniques, and 
2. Using spacegraphcats to query a metagenome with a CMAG it precipitated leads to the recovery of "off target" sequences. </p>
<p>A Snakemake workflow is available for this analysis <a href="https://github.com/taylorreiter/2019-pere/blob/master/Snakefile">here</a>.</p>
<p>After k-mer trimming the metagenome, we used a CMAG to query into the assembly graph. 
We retrieved the reads for the query neighborhood and mapped these back to the CMAG assembly, and then retrieved unmapped reads.<br />
99.82% of reads in the query neighborhood mapped back to the query, indicating there was little strain variation in the reads not accounted for in the assembly.
Using megahit, the unmapped reads assembled into 5 contigs ranging in size from 179-208bp. 
When BLASTed (<code>blastn</code>, <code>blastx</code>) against the NCBI nr database, four of the five contigs matched 16S or 23S ribosomal RNA. 
This likely indicates that sequences that are highly conserved between distantly related species may be included in spacegraphcats query neighborhoods; users should keep this in mind when asking biological questions about highly conserved sequences (e.g. ribosomal RNA). 
The fifth sequence had no nucleotide matches, but matched a hypothetical protein
Candidatus Uhrbacteria bacterium RIFOXYA2_FULL_40_9.
This may indicate strain variation in these hypothetical protein sequence not captured in the CMAG.</p>
<pre><code> hypothetical protein A2239_02390 [Candidatus Uhrbacteria bacterium RIFOXYA2_FULL_40_9]
Sequence ID: OGL93914.1
Length: 354
Number of Matches: 1

Identical Proteins-Identical proteins to OGL93914.1
Range 1: 314 to 354
Alignment statistics for match #1 Score Expect  Method  Identities  Positives   Gaps    Frame
85.1 bits(209)  2e-17   Compositional matrix adjust.    41/41(100%)     41/41(100%)     0/41(0%)    -1

Query  201  SEEEQEAHWKLYEDSLAYLVAHPDEYRALNAVGLLEEFDWE  79
            SEEEQEAHWKLYEDSLAYLVAHPDEYRALNAVGLLEEFDWE
Sbjct  314  SEEEQEAHWKLYEDSLAYLVAHPDEYRALNAVGLLEEFDWE  354
</code></pre>
<h3 id="exploring-taxonomy-of-cdbg-nodes-within-dominators-using-a-simple-metagenome">Exploring taxonomy of cDBG nodes within dominators using a simple metagenome</h3>
<p>Below we explore the taxonomy of spacegraphcats results using the experimental synthetic metagenome.
The metagenome was published by <a href="https://www.ncbi.nlm.nih.gov/pubmed/23387867">Shakya et al., 2013</a>.
It contains sequences from isolate DNA that were aliquoted together prior to sequencing, so it is less complex than real community metagenomes.
Two of the genomes are different strains from the same species, and one of the genomes is a completely different class from the other two. 
In spacegraphcats land, we refer to a subset of this data as <code>twofoo</code>.</p>
<p>The utility script <code>explore-dominator-taxonomy.py</code>
- Takes all sourmash hashes in the dataset and retrieves the cDBG unitig IDs to which they belong;
- It then aggregates those hashes under the dom nodes to which those cDBG unitigs belong;
- Finally, it calculates the taxonomy of the dom node based on the LCA of the hash values.</p>
<p>Below we show the taxonomy results when <code>r = 1</code> and <code>r = 5</code>.</p>
<pre><code>scripts/explore-dominator-taxonomy.py twofoo_k31_r1 twofoo_k31_r1_hashval_k31/index.pickle ../sourmash/podar-ref.lca.json.gz
</code></pre>
<p>Gives the following results:</p>
<pre><code>88512 dom nodes have no sourmash hashes under them.
903 dom nodes have exactly one sourmash hash under them.
37 dom nodes have two or more sourmash hashes under them.

rank of dom node lca  count of dom nodes with that rank
--------------------  ---------------------------------
strain                  35
species                  2
</code></pre>
<p>What we see is that the graphs for the two different species are completely non-overlapping (at least at the resolution of sourmash k=31 scaled=1000) while the graphs for the genomes from the same strain are overlapping.</p>
<p>More specifically, 35 of the dom nodes have cDBG nodes with two or more hashvals under them that belong to the same strain, while only two of the dom nodes contain cDBGs with hashvals from the two different strains. 
At the resolution we're using here, the vast majority of cDBG nodes and dom nodes have no associated hashvals, which maybe says we should be using higher resolution sourmash or larger r!</p>
<p>Using a radius of 5:</p>
<pre><code>loaded 27124 nodes from catlas twofoo_k31_r5
loaded 15031 layer 1 catlas nodes
loaded 9447551 k-mers in index (0.4s)
loaded 985 hash value -&gt; cdbg_id mappings from twofoo_k31_r5_hashval_k31/index.pickle
14149 dom nodes have no sourmash hashes under them.
796 dom nodes have exactly one sourmash hash under them.
86 dom nodes have two or more sourmash hashes under them.

rank of dom node lca  count of dom nodes with that rank
--------------------  ---------------------------------
strain                  76
species                  10
</code></pre>
<p>The higher radius 'annotates' more dom nodes with taxonomy.
In this example, there is still no increase in taxonomic confusion above the species level, which is good and expected for synthetic data.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 <a href="http://ivory.idyll.org/lab/">Lab for Data Intensive Biology</a> at UC Davis and <a href="https://www.cs.utah.edu/~sullivan/#!/">Theory in Practice Lab at University of Utah
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>